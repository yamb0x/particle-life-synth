<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Unified Presets Test</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #ccc;
            padding: 20px;
        }
        .test {
            margin: 10px 0;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 5px;
        }
        .pass { color: #4a9eff; }
        .fail { color: #ff4444; }
        .info { color: #888; }
        button {
            margin: 5px;
            padding: 5px 10px;
            background: #4a9eff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #3a8eff;
        }
    </style>
</head>
<body>
    <h1>Unified Presets System Test</h1>
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        async function runTests() {
            log('Starting unified presets system tests...', 'info');
            
            // Test 1: Check if old PRESETS section is removed
            log('Test 1: Checking if old PRESETS section is removed...');
            const oldPresetSection = Array.from(document.querySelectorAll('h4.section-title'))
                .find(h => h.textContent === 'Presets');
            if (!oldPresetSection) {
                log('✅ Old PRESETS section successfully removed', 'pass');
            } else {
                log('❌ Old PRESETS section still exists', 'fail');
            }
            
            // Test 2: Check if new unified section exists
            log('Test 2: Checking for unified Presets & Actions section...');
            const unifiedSection = Array.from(document.querySelectorAll('h4.section-title'))
                .find(h => h.textContent === 'Presets & Actions');
            if (unifiedSection) {
                log('✅ Unified Presets & Actions section exists', 'pass');
            } else {
                log('❌ Unified section not found', 'fail');
            }
            
            // Test 3: Check Firebase status elements
            log('Test 3: Checking Firebase status elements...');
            const statusEl = document.getElementById('connection-status');
            const countEl = document.getElementById('preset-count');
            if (statusEl && countEl) {
                log('✅ Firebase status elements present', 'pass');
                log(`   Status: ${statusEl.textContent}`, 'info');
                log(`   Count: ${countEl.textContent}`, 'info');
            } else {
                log('❌ Firebase status elements missing', 'fail');
            }
            
            // Test 4: Check preset selector
            log('Test 4: Checking preset selector...');
            const selector = document.getElementById('preset-selector');
            if (selector) {
                log('✅ Preset selector exists', 'pass');
                log(`   Options count: ${selector.options.length}`, 'info');
            } else {
                log('❌ Preset selector not found', 'fail');
            }
            
            // Test 5: Check preset name input
            log('Test 5: Checking preset name input...');
            const nameInput = document.getElementById('preset-name-input');
            if (nameInput) {
                log('✅ Preset name input exists', 'pass');
            } else {
                log('❌ Preset name input not found', 'fail');
            }
            
            // Test 6: Check save button
            log('Test 6: Checking save/update button...');
            const saveBtn = document.getElementById('save-preset-btn');
            if (saveBtn) {
                log('✅ Save button exists', 'pass');
                log(`   Button text: "${saveBtn.textContent}"`, 'info');
                
                // Test dynamic button behavior
                if (nameInput) {
                    log('Test 6a: Testing dynamic button behavior...');
                    
                    // Test with empty name
                    nameInput.value = '';
                    nameInput.dispatchEvent(new Event('input'));
                    await new Promise(r => setTimeout(r, 100));
                    const updateText = saveBtn.textContent;
                    
                    // Test with new name
                    nameInput.value = 'Test Preset';
                    nameInput.dispatchEvent(new Event('input'));
                    await new Promise(r => setTimeout(r, 100));
                    const saveNewText = saveBtn.textContent;
                    
                    if (updateText.includes('Update') || saveNewText.includes('Save New')) {
                        log('✅ Dynamic button behavior working', 'pass');
                        log(`   Empty name: "${updateText}"`, 'info');
                        log(`   With name: "${saveNewText}"`, 'info');
                    } else {
                        log('⚠️ Dynamic button behavior may not be working correctly', 'fail');
                    }
                    
                    // Clear test input
                    nameInput.value = '';
                }
            } else {
                log('❌ Save button not found', 'fail');
            }
            
            // Test 7: Check if randomize button is removed
            log('Test 7: Checking if randomize button is removed...');
            const randomizeBtn = document.getElementById('randomize-values-btn');
            if (!randomizeBtn) {
                log('✅ Randomize button successfully removed', 'pass');
            } else {
                log('❌ Randomize button still exists', 'fail');
            }
            
            // Test 8: Check if load preset button is removed
            log('Test 8: Checking if load preset button is removed...');
            const loadBtn = document.getElementById('load-preset-btn');
            if (!loadBtn) {
                log('✅ Load preset button successfully removed', 'pass');
            } else {
                log('❌ Load preset button still exists', 'fail');
            }
            
            // Test 9: Check Firebase connection
            log('Test 9: Checking Firebase connection...');
            if (window.mainUI && window.mainUI.presetManager) {
                const isConnected = window.mainUI.presetManager.isCloudEnabled();
                if (isConnected) {
                    log('✅ Firebase is connected', 'pass');
                    const presets = window.mainUI.presetManager.getUserPresets();
                    const cloudPresets = presets.filter(p => p.source === 'cloud');
                    log(`   Cloud presets: ${cloudPresets.length}`, 'info');
                } else {
                    log('⚠️ Firebase is connecting...', 'info');
                }
            } else {
                log('⚠️ MainUI not initialized yet', 'info');
            }
            
            // Test 10: Check keyboard shortcuts still work
            log('Test 10: Testing keyboard shortcuts...');
            log('   Press V to randomize values (shortcut only, no button)', 'info');
            log('   Press C to toggle controls', 'info');
            log('   Press Shift+Plus/Minus to navigate presets', 'info');
            
            log('\n✨ Test complete! Check the application UI to verify all functionality.', 'pass');
        }
        
        // Wait for page to load
        setTimeout(runTests, 2000);
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>MainUI Fix Verification</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #0a0a0f;
            color: #4ecdc4;
        }
        .status-panel {
            background: rgba(10, 10, 15, 0.95);
            border: 1px solid rgba(78, 205, 196, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .success { color: #4ade80; }
        .error { color: #ff5555; }
        .warning { color: #fbbf24; }
        .info { color: #4ecdc4; }
        .iframe-container {
            border: 2px solid #4ecdc4;
            border-radius: 8px;
            height: 600px;
            position: relative;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 6px;
        }
        .overlay-instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 0, 0.9);
            color: black;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 999999;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="status-panel">
        <h2>🔧 MainUI Template Literal Fix Verification</h2>
        <div id="status">Loading verification...</div>
    </div>
    
    <div class="status-panel">
        <h3>✅ What was fixed:</h3>
        <ul>
            <li><strong>Template Literal Safety</strong>: Added <code>safeValue()</code> and <code>safeFixed()</code> helper methods</li>
            <li><strong>Undefined Property Protection</strong>: All template expressions now have fallback values</li>
            <li><strong>Null/Undefined Checks</strong>: Safe property access with optional chaining where needed</li>
            <li><strong>Z-Index Hierarchy</strong>: Fixed CSS variable system for proper layering</li>
        </ul>
    </div>

    <div class="iframe-container">
        <div class="overlay-instructions">
            <strong>Look for:</strong><br>
            ✓ MainUI panel on the right side<br>
            ✓ Particle controls (sliders, buttons)<br>
            ✓ Audio panel on the left side<br>
            ✓ Both panels should be visible together
        </div>
        <iframe id="app-frame" src="http://localhost:8000"></iframe>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const className = type;
            status.innerHTML += `<div class="${className}">• ${message}</div>`;
        }

        function verifyFix() {
            updateStatus('🔍 Verifying MainUI template literal fix...', 'info');
            
            setTimeout(() => {
                try {
                    const iframe = document.getElementById('app-frame');
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    if (iframeDoc) {
                        const mainUIContainer = iframeDoc.querySelector('.main-ui-container');
                        
                        if (mainUIContainer) {
                            const rect = mainUIContainer.getBoundingClientRect();
                            const visible = rect.width > 0 && rect.height > 0;
                            
                            if (visible) {
                                updateStatus('✅ SUCCESS: MainUI container is visible!', 'success');
                                updateStatus(`📐 Dimensions: ${Math.round(rect.width)}x${Math.round(rect.height)}`, 'success');
                                updateStatus(`📍 Position: right=${Math.round(rect.right)}, top=${Math.round(rect.top)}`, 'success');
                                
                                // Check if it has content
                                const hasContent = mainUIContainer.innerHTML.length > 1000;
                                if (hasContent) {
                                    updateStatus('✅ MainUI has proper content loaded', 'success');
                                } else {
                                    updateStatus('⚠️ MainUI visible but content seems minimal', 'warning');
                                }
                                
                                // Check for audio panel too
                                const audioPanel = iframeDoc.querySelector('#left-panel');
                                if (audioPanel) {
                                    const audioRect = audioPanel.getBoundingClientRect();
                                    const audioVisible = audioRect.width > 0 && audioRect.height > 0;
                                    if (audioVisible) {
                                        updateStatus('✅ Audio panel also visible!', 'success');
                                        updateStatus('🎵 COMPLETE: Both MainUI and Audio panels are working!', 'success');
                                    } else {
                                        updateStatus('⚠️ Audio panel exists but not visible', 'warning');
                                    }
                                } else {
                                    updateStatus('⚠️ Audio panel not found', 'warning');
                                }
                                
                            } else {
                                updateStatus('❌ MainUI container exists but not visible', 'error');
                                updateStatus(`📐 Zero dimensions: ${rect.width}x${rect.height}`, 'error');
                            }
                        } else {
                            updateStatus('❌ MainUI container not found in DOM', 'error');
                            updateStatus('🔍 Template literal errors may still be preventing creation', 'error');
                        }
                    } else {
                        updateStatus('❌ Cannot access iframe content', 'error');
                    }
                } catch (error) {
                    updateStatus(`❌ Verification error: ${error.message}`, 'error');
                }
            }, 3000); // Wait for page to fully load
        }

        // Start verification when iframe loads
        document.getElementById('app-frame').addEventListener('load', () => {
            updateStatus('📄 Application loaded, starting verification...', 'info');
            verifyFix();
        });

        // Fallback verification after 5 seconds
        setTimeout(() => {
            if (document.getElementById('status').innerHTML.includes('Loading')) {
                verifyFix();
            }
        }, 5000);
    </script>
</body>
</html>
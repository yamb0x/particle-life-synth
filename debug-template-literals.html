<!DOCTYPE html>
<html>
<head>
    <title>Debug Template Literals</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #0a0a0f;
            color: #4ecdc4;
        }
        .debug-panel {
            background: rgba(10, 10, 15, 0.95);
            border: 1px solid rgba(78, 205, 196, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 4px;
            border-left: 3px solid #4ECDC4;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .error { color: #ff5555; }
        .success { color: #4ade80; }
        .warning { color: #fbbf24; }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h2>Template Literal Debug</h2>
        <p>Testing if template literals in MainUI are causing the issue:</p>
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            results.innerHTML += `<div class="${className}">${message}</div>`;
        }

        // Mock particle system to test template literals
        const mockParticleSystem = {
            particlesPerSpecies: 100,
            numSpecies: 4,
            breathEnabled: false,
            breathMin: 0,
            breathMax: 5,
            breathTime: 3,
            forceFactor: 1.0,
            friction: 0.95,
            socialRadius: [[50]]
        };

        log('=== TESTING TEMPLATE LITERALS ===');

        // Test each template expression individually
        const testExpressions = [
            () => `${mockParticleSystem.particlesPerSpecies}`,
            () => `${mockParticleSystem.numSpecies}`,
            () => `${mockParticleSystem.breathEnabled ? 'checked' : ''}`,
            () => `${!mockParticleSystem.breathEnabled ? 'display: none;' : ''}`,
            () => `${mockParticleSystem.breathMin.toFixed(1)}`,
            () => `${mockParticleSystem.breathMax.toFixed(1)}`,
            () => `${mockParticleSystem.breathMin}`,
            () => `${mockParticleSystem.breathMax}`,
            () => `${mockParticleSystem.breathTime.toFixed(1)}s`,
            () => `${mockParticleSystem.breathTime}`,
            () => `${mockParticleSystem.forceFactor.toFixed(1)}`,
            () => `${(1.0 - mockParticleSystem.friction).toFixed(2)}`,
            () => `${1.0 - mockParticleSystem.friction}`,
            () => `${mockParticleSystem.socialRadius[0][0]}`,
        ];

        testExpressions.forEach((expr, index) => {
            try {
                const result = expr();
                log(`✓ Expression ${index + 1}: "${result}"`, 'success');
            } catch (error) {
                log(`✗ Expression ${index + 1} FAILED: ${error.message}`, 'error');
            }
        });

        // Test full template with undefined properties
        log('<br>=== TESTING WITH UNDEFINED PROPERTIES ===');
        
        const brokenParticleSystem = {
            // Missing many properties
            particlesPerSpecies: 100,
            numSpecies: 4,
        };

        const testTemplateWithBroken = () => {
            return `
                <span>${brokenParticleSystem.particlesPerSpecies}</span>
                <span>${brokenParticleSystem.numSpecies}</span>
                <input type="checkbox" ${brokenParticleSystem.breathEnabled ? 'checked' : ''}>
                <span>${brokenParticleSystem.breathMin.toFixed(1)}</span>
            `;
        };

        try {
            const result = testTemplateWithBroken();
            log('✓ Template with undefined properties succeeded', 'success');
        } catch (error) {
            log(`✗ Template with undefined properties FAILED: ${error.message}`, 'error');
            log('THIS IS LIKELY THE MAINUI ISSUE!', 'warning');
        }

        // Test safe template approach
        log('<br>=== TESTING SAFE TEMPLATE APPROACH ===');
        
        const safeTemplate = (ps) => {
            const safe = (value, defaultValue = '') => value !== undefined && value !== null ? value : defaultValue;
            const safeFixed = (value, digits = 1, defaultValue = '0') => {
                return value !== undefined && value !== null && typeof value === 'number' 
                    ? value.toFixed(digits) 
                    : defaultValue;
            };
            
            return `
                <span>${safe(ps.particlesPerSpecies, 100)}</span>
                <span>${safe(ps.numSpecies, 4)}</span>
                <input type="checkbox" ${safe(ps.breathEnabled) ? 'checked' : ''}>
                <span>${safeFixed(ps.breathMin, 1, '0.0')}</span>
                <span>${safeFixed(ps.breathMax, 1, '5.0')}</span>
                <span>${safeFixed(ps.forceFactor, 1, '1.0')}</span>
            `;
        };

        try {
            const safeResult = safeTemplate(brokenParticleSystem);
            log('✓ Safe template approach succeeded', 'success');
            log('Safe template result: ' + safeResult.substring(0, 100) + '...', 'success');
        } catch (error) {
            log(`✗ Safe template approach FAILED: ${error.message}`, 'error');
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Monitor Test</title>
    <link rel="stylesheet" href="src/styles/design-system.css">
</head>
<body>
    <h1>Performance Monitor Component Test</h1>
    <p>This test demonstrates the new PerformanceMonitor UI component.</p>
    
    <div style="margin: 20px 0;">
        <button id="toggle-visibility">Toggle Visibility</button>
        <button id="toggle-collapse">Toggle Collapse</button>
        <button id="simulate-load">Simulate Load</button>
    </div>

    <canvas id="canvas" width="800" height="600" style="border: 1px solid #333; display: block; margin: 20px 0;"></canvas>

    <script type="module">
        import { SimpleParticleSystem } from './src/core/SimpleParticleSystem.js';
        import { PerformanceMonitor } from './src/ui/PerformanceMonitor.js';

        // Create a simple particle system for testing
        const canvas = document.getElementById('canvas');
        const particleSystem = new SimpleParticleSystem(canvas.width, canvas.height);
        
        // Initialize with some test particles
        particleSystem.setParticleCount(100);
        particleSystem.setNumSpecies(3);
        particleSystem.createParticles();

        // Create the performance monitor
        const performanceMonitor = new PerformanceMonitor(particleSystem);

        // Mock audio system for testing
        const mockAudioSystem = {
            isInitialized: true,
            audioEngine: {
                audioContext: {
                    state: 'running'
                }
            }
        };

        // Set the mock audio system
        setTimeout(() => {
            performanceMonitor.setAudioSystem(mockAudioSystem);
        }, 1000);

        // Test buttons
        document.getElementById('toggle-visibility').addEventListener('click', () => {
            performanceMonitor.toggleVisibility();
        });

        document.getElementById('toggle-collapse').addEventListener('click', () => {
            performanceMonitor.toggleCollapse();
        });

        document.getElementById('simulate-load').addEventListener('click', () => {
            // Simulate high load by adding more particles
            const currentCount = particleSystem.particles.length;
            const newCount = currentCount > 500 ? 100 : currentCount + 200;
            particleSystem.setParticleCount(newCount);
            particleSystem.createParticles();
            console.log(`Particle count changed to: ${newCount}`);
        });

        // Simple animation loop to update the particle system
        let lastTime = 0;
        function animate(currentTime) {
            const deltaTime = Math.min((currentTime - lastTime) / 1000, 0.1);
            lastTime = currentTime;

            // Update particle system
            particleSystem.update(deltaTime);

            // Render particles
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Simple particle rendering
            ctx.fillStyle = 'white';
            particleSystem.particles.forEach(particle => {
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size || 2, 0, Math.PI * 2);
                ctx.fill();
            });

            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);

        console.log('Performance Monitor test loaded. Use the buttons to test functionality.');
        console.log('- Toggle Visibility: Show/hide the entire monitor');
        console.log('- Toggle Collapse: Expand/collapse the metrics section');
        console.log('- Simulate Load: Add more particles to test performance display');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Shortcut Test</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: monospace;
            padding: 20px;
        }
        .test-results {
            margin: 20px 0;
            padding: 15px;
            background: #222;
            border-radius: 5px;
        }
        .pass { color: #4ade80; }
        .fail { color: #ef4444; }
        .info { color: #60a5fa; }
        button {
            background: #333;
            color: #fff;
            border: 1px solid #666;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <h1>Preset Modal Keyboard Shortcut Test</h1>
    
    <div class="test-results">
        <h3>Test Instructions:</h3>
        <ol>
            <li>Click "Open Modal" button below</li>
            <li>When modal opens, try typing in the "Preset Name" input field</li>
            <li>Press keys: c, x, r, v while focused on the input</li>
            <li>Verify that shortcuts are NOT triggered (UI should not toggle, randomize, etc.)</li>
            <li>Close modal and try shortcuts again - they should work normally</li>
        </ol>
    </div>
    
    <div class="test-results">
        <h3>Keyboard Shortcuts to Test:</h3>
        <ul>
            <li><strong>C</strong> - Toggle UI visibility</li>
            <li><strong>X</strong> - Copy settings</li>
            <li><strong>R</strong> - Randomize forces</li>
            <li><strong>V</strong> - Randomize values</li>
        </ul>
    </div>
    
    <div class="test-results">
        <h3>Shortcut Activity Log:</h3>
        <div id="activity-log" style="height: 150px; overflow-y: auto; background: #111; padding: 10px; border-radius: 4px;">
            <div class="info">Listening for keyboard shortcuts...</div>
        </div>
    </div>
    
    <button onclick="openModal()">Open Modal</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <canvas id="canvas" width="800" height="600" style="border: 1px solid #333; margin-top: 20px;"></canvas>

    <script type="module">
        import { SimpleParticleSystem } from './src/core/SimpleParticleSystem.js';
        import { HybridPresetManager } from './src/utils/HybridPresetManager.js';
        import { PresetModal } from './src/ui/PresetModal.js';
        
        const canvas = document.getElementById('canvas');
        canvas.width = 800;
        canvas.height = 600;
        
        // Create particle system
        const particleSystem = new SimpleParticleSystem(canvas.width, canvas.height);
        particleSystem.setCanvas(canvas);
        
        // Create preset manager
        const presetManager = new HybridPresetManager();
        
        // Create preset modal
        const presetModal = new PresetModal(particleSystem, presetManager);
        window.presetModal = presetModal;
        
        // Mock the main UI functions that are normally provided by main.js
        window.updateUIFromPreset = function(particleSystem) {
            logActivity('updateUIFromPreset called', 'info');
        };
        
        window.updatePresetSelector = function() {
            logActivity('updatePresetSelector called', 'info');
        };
        
        // Add keyboard shortcut listener to test
        document.addEventListener('keydown', (e) => {
            // Skip all shortcuts if modal is open to avoid conflicts with text input
            if (window.presetModal && window.presetModal.isOpen) {
                logActivity(`Shortcut '${e.key}' blocked (modal is open)`, 'pass');
                return;
            }
            
            // Skip shortcuts if modifier keys are pressed
            if (e.ctrlKey || e.metaKey || e.altKey) return;
            
            switch(e.key.toLowerCase()) {
                case 'c':
                    logActivity("Shortcut 'C' triggered - Toggle visibility", 'fail');
                    e.preventDefault();
                    break;
                case 'x':
                    logActivity("Shortcut 'X' triggered - Copy settings", 'fail');
                    e.preventDefault();
                    break;
                case 'r':
                    logActivity("Shortcut 'R' triggered - Randomize forces", 'fail');
                    e.preventDefault();
                    break;
                case 'v':
                    logActivity("Shortcut 'V' triggered - Randomize values", 'fail');
                    e.preventDefault();
                    break;
            }
        });
        
        // Test functions
        window.openModal = function() {
            logActivity('Opening modal...', 'info');
            presetModal.open();
        };
        
        window.clearLog = function() {
            const log = document.getElementById('activity-log');
            log.innerHTML = '<div class="info">Log cleared - listening for keyboard shortcuts...</div>';
        };
        
        function logActivity(message, type = 'info') {
            const log = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${timestamp}] ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }
        
        // Start animation loop
        function animate() {
            particleSystem.update(0.016);
            requestAnimationFrame(animate);
        }
        animate();
        
        logActivity('Test environment initialized', 'pass');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Collapsible Fix</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            margin: 0;
        }
        
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4CAF50;
        }
        
        .status-box {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .debug-item {
            margin: 10px 0;
            padding: 10px;
            background: #333;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .highlight {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .error {
            color: #f44336;
            font-weight: bold;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        .log {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Debug Collapsible Height Fix</h1>
        
        <div class="status-box">
            <h2>Quick Actions</h2>
            <button onclick="checkParticlesSection()">Check Particles Section</button>
            <button onclick="checkForcesSection()">Check Forces Section</button>
            <button onclick="checkUIContainer()">Check UI Container</button>
            <button onclick="applyFix()">Apply Height Fix</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div class="status-box">
            <h2>Section Analysis</h2>
            <div id="section-analysis"></div>
        </div>
        
        <div class="status-box">
            <h2>Debug Log</h2>
            <div class="log" id="debug-log"></div>
        </div>
    </div>
    
    <script>
        const log = (msg, type = 'info') => {
            const logEl = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            logEl.textContent += `[${timestamp}] ${prefix} ${msg}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        };
        
        const checkParticlesSection = () => {
            log('Checking Particles Section...', 'info');
            
            // Find the particles section
            const sections = document.querySelectorAll('.collapsible-section');
            let particlesSection = null;
            
            sections.forEach(section => {
                if (section.dataset.sectionId === 'particles' || 
                    section.querySelector('[data-section-content="particles"]')) {
                    particlesSection = section;
                }
            });
            
            if (!particlesSection) {
                log('Particles section not found!', 'error');
                return;
            }
            
            log('Found particles section', 'success');
            
            // Check if it's open
            const isOpen = particlesSection.classList.contains('open');
            log(`Section is ${isOpen ? 'OPEN' : 'CLOSED'}`, isOpen ? 'success' : 'info');
            
            // Get the content element
            const content = particlesSection.querySelector('.collapsible-content');
            if (content) {
                const maxHeight = content.style.maxHeight;
                const computedHeight = window.getComputedStyle(content).maxHeight;
                const scrollHeight = content.scrollHeight;
                
                log(`Inline max-height: ${maxHeight || 'not set'}`, 'info');
                log(`Computed max-height: ${computedHeight}`, 'info');
                log(`Scroll height: ${scrollHeight}px`, 'info');
                
                // Check if it's properly set to 3000px
                if (maxHeight && maxHeight.includes('3000')) {
                    log('Max-height is correctly set to 3000px!', 'success');
                } else {
                    log('Max-height is NOT set to 3000px', 'error');
                }
                
                // Check actual rendered height
                const rect = content.getBoundingClientRect();
                log(`Actual rendered height: ${rect.height}px`, 'info');
                
                if (rect.height < scrollHeight) {
                    log(`Content is being clipped! (${rect.height}px < ${scrollHeight}px)`, 'error');
                }
            }
            
            updateAnalysis();
        };
        
        const checkForcesSection = () => {
            log('Checking Forces Section...', 'info');
            
            const sections = document.querySelectorAll('.collapsible-section');
            let forcesSection = null;
            
            sections.forEach(section => {
                if (section.dataset.sectionId === 'forces' || 
                    section.querySelector('[data-section-content="forces"]')) {
                    forcesSection = section;
                }
            });
            
            if (!forcesSection) {
                log('Forces section not found!', 'error');
                return;
            }
            
            log('Found forces section', 'success');
            
            const isOpen = forcesSection.classList.contains('open');
            log(`Section is ${isOpen ? 'OPEN' : 'CLOSED'}`, isOpen ? 'success' : 'info');
            
            const content = forcesSection.querySelector('.collapsible-content');
            if (content) {
                const maxHeight = content.style.maxHeight;
                const computedHeight = window.getComputedStyle(content).maxHeight;
                
                log(`Inline max-height: ${maxHeight || 'not set'}`, 'info');
                log(`Computed max-height: ${computedHeight}`, 'info');
                
                if (maxHeight && maxHeight.includes('2500')) {
                    log('Max-height is correctly set to 2500px!', 'success');
                } else {
                    log('Max-height is NOT set to 2500px', 'error');
                }
            }
            
            updateAnalysis();
        };
        
        const checkUIContainer = () => {
            log('Checking UI Container...', 'info');
            
            const container = document.querySelector('.main-ui-container');
            if (!container) {
                log('UI container not found!', 'error');
                return;
            }
            
            const styles = window.getComputedStyle(container);
            log(`Position: ${styles.position}`, 'info');
            log(`Top: ${styles.top}`, 'info');
            log(`Bottom: ${styles.bottom}`, 'info');
            log(`Max-height: ${styles.maxHeight}`, 'info');
            log(`Overflow-y: ${styles.overflowY}`, 'info');
            
            const rect = container.getBoundingClientRect();
            log(`Container height: ${rect.height}px`, 'info');
            log(`Viewport height: ${window.innerHeight}px`, 'info');
            
            if (styles.maxHeight && styles.maxHeight.includes('calc')) {
                log('Container is constrained by viewport!', 'error');
                log(`Max allowed: ${window.innerHeight - 20}px`, 'info');
            }
            
            // Check scrollable height
            log(`Scroll height: ${container.scrollHeight}px`, 'info');
            if (container.scrollHeight > rect.height) {
                log('Container is scrollable', 'success');
            } else {
                log('Container is not scrollable', 'info');
            }
        };
        
        const applyFix = () => {
            log('Attempting to apply fix...', 'info');
            
            // Try to find collapsibleUI in window
            if (window.collapsibleUI) {
                log('Found collapsibleUI object', 'success');
                
                // Force refresh heights
                if (window.collapsibleUI.refreshAllHeights) {
                    window.collapsibleUI.refreshAllHeights();
                    log('Called refreshAllHeights()', 'success');
                }
                
                // Specifically update particles and forces
                const sections = window.collapsibleUI.sections;
                if (sections) {
                    const particlesSection = sections.get('particles');
                    const forcesSection = sections.get('forces');
                    
                    if (particlesSection && particlesSection.isOpen) {
                        particlesSection.contentElement.style.setProperty('max-height', '3000px', 'important');
                        log('Forced particles section to 3000px', 'success');
                    }
                    
                    if (forcesSection && forcesSection.isOpen) {
                        forcesSection.contentElement.style.setProperty('max-height', '2500px', 'important');
                        log('Forced forces section to 2500px', 'success');
                    }
                }
            } else {
                log('collapsibleUI not found in window!', 'error');
            }
            
            // Try direct DOM manipulation as fallback
            const particlesContent = document.querySelector('[data-section-content="particles"]');
            if (particlesContent) {
                particlesContent.style.setProperty('max-height', '3000px', 'important');
                log('Direct DOM: Set particles to 3000px', 'success');
            }
            
            const forcesContent = document.querySelector('[data-section-content="forces"]');
            if (forcesContent) {
                forcesContent.style.setProperty('max-height', '2500px', 'important');
                log('Direct DOM: Set forces to 2500px', 'success');
            }
        };
        
        const updateAnalysis = () => {
            const analysis = document.getElementById('section-analysis');
            
            const sections = document.querySelectorAll('.collapsible-section');
            let html = '';
            
            sections.forEach((section, index) => {
                const id = section.dataset.sectionId || `section-${index}`;
                const isOpen = section.classList.contains('open');
                const content = section.querySelector('.collapsible-content');
                
                let maxHeight = 'N/A';
                let actualHeight = 'N/A';
                
                if (content) {
                    maxHeight = content.style.maxHeight || window.getComputedStyle(content).maxHeight || 'none';
                    actualHeight = content.getBoundingClientRect().height + 'px';
                }
                
                const statusColor = isOpen ? '#4CAF50' : '#999';
                html += `
                    <div class="debug-item">
                        <strong style="color: ${statusColor}">${id}</strong>: 
                        ${isOpen ? 'OPEN' : 'CLOSED'} | 
                        Max-height: ${maxHeight} | 
                        Actual: ${actualHeight}
                    </div>
                `;
            });
            
            analysis.innerHTML = html || '<div class="debug-item">No sections found</div>';
        };
        
        const clearLog = () => {
            document.getElementById('debug-log').textContent = '';
            log('Log cleared', 'success');
        };
        
        // Auto-check on load
        setTimeout(() => {
            log('Page loaded, running initial checks...', 'info');
            updateAnalysis();
            checkUIContainer();
        }, 1000);
    </script>
</body>
</html>
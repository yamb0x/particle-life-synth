<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preset Filtering Test</title>
</head>
<body>
    <h1>Preset Filtering Test</h1>
    <div id="results"></div>
    
    <script type="module">
        import { HybridPresetManager } from './src/utils/HybridPresetManager.js';
        
        async function testPresetFiltering() {
            const results = document.getElementById('results');
            
            try {
                const presetManager = new HybridPresetManager();
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                console.log('Testing preset filtering...');
                
                // Test the isInvalidPresetName method
                const testNames = [
                    'SimplifiedWorkflowTest',
                    'conf_02',
                    'confett', 
                    'confetty',
                    'blood_cells',
                    'predators_seek',
                    'ge-ko-system',
                    'test_preset',
                    'workflowvalidation',
                    'my_custom_preset'
                ];
                
                results.innerHTML = '<h2>isInvalidPresetName Test Results:</h2>';
                
                testNames.forEach(name => {
                    const isInvalid = presetManager.isInvalidPresetName(name);
                    const color = isInvalid ? 'red' : 'green';
                    const status = isInvalid ? 'FILTERED OUT' : 'ALLOWED';
                    results.innerHTML += `<p style="color: ${color};">${name}: ${status}</p>`;
                });
                
                // Test getUserPresets method
                const userPresets = presetManager.getUserPresets();
                results.innerHTML += '<h2>Current User Presets:</h2>';
                
                if (userPresets.length === 0) {
                    results.innerHTML += '<p>No user presets found (good - test presets should be filtered out)</p>';
                } else {
                    userPresets.forEach(preset => {
                        results.innerHTML += `<p style="color: blue;">• ${preset.name}</p>`;
                    });
                }
                
                // Check localStorage directly
                const stored = localStorage.getItem('particleLifePresets');
                if (stored) {
                    const customPresets = JSON.parse(stored);
                    results.innerHTML += '<h2>localStorage Contents:</h2>';
                    Object.keys(customPresets).forEach(key => {
                        const preset = customPresets[key];
                        const isInvalid = presetManager.isInvalidPresetName(preset.name);
                        const color = isInvalid ? 'red' : 'blue';
                        results.innerHTML += `<p style="color: ${color};">• ${preset.name} (key: ${key})</p>`;
                    });
                }
                
            } catch (error) {
                results.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        // Run test when page loads
        testPresetFiltering();
    </script>
</body>
</html>
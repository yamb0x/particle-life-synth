<!DOCTYPE html>
<html>
<head>
    <title>Environment Consistency Test</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #000; color: #0f0; }
        .test { margin: 10px 0; padding: 5px; }
        .pass { background: #004400; }
        .fail { background: #440000; }
        .warn { background: #444400; }
    </style>
</head>
<body>
    <h1>Environment Consistency Test</h1>
    <div id="results"></div>
    
    <script type="module">
        import { EnvironmentManager } from './src/utils/EnvironmentManager.js';
        
        const results = document.getElementById('results');
        
        function addTest(name, condition, message) {
            const div = document.createElement('div');
            div.className = 'test ' + (condition ? 'pass' : 'fail');
            div.innerHTML = `<strong>${condition ? '✅' : '❌'} ${name}</strong>: ${message}`;
            results.appendChild(div);
        }
        
        function addWarning(name, message) {
            const div = document.createElement('div');
            div.className = 'test warn';
            div.innerHTML = `<strong>⚠️ ${name}</strong>: ${message}`;
            results.appendChild(div);
        }
        
        // Wait for main.js to load
        setTimeout(() => {
            const envInfo = EnvironmentManager.getEnvironmentInfo();
            
            // Environment Detection Tests
            addTest('Environment Manager', typeof EnvironmentManager === 'function', 'Available and accessible');
            addTest('Environment Info', !!envInfo, JSON.stringify(envInfo, null, 2));
            
            // Global Variables Tests (Critical for functionality)
            addTest('window.mainUI', !!window.mainUI, `Type: ${typeof window.mainUI}`);
            addTest('window.leftPanel', !!window.leftPanel, `Type: ${typeof window.leftPanel}`);
            addTest('window.particleSystem', !!window.particleSystem, `Type: ${typeof window.particleSystem}`);
            addTest('window.audioSystem', !!window.audioSystem, `Type: ${typeof window.audioSystem}`);
            
            // Functionality Tests
            addTest('MainUI.toggleVisibility', 
                !!window.mainUI?.toggleVisibility, 
                'Keyboard shortcuts will work');
                
            addTest('LeftPanel.updateSpeciesCount', 
                !!window.leftPanel?.updateSpeciesCount, 
                'Species sync will work');
                
            // Environment-specific warnings
            if (!envInfo.isDevelopment && !envInfo.isDebug) {
                addWarning('Production Mode', 'Running in production mode - reduced debug info');
            }
            
            if (window.location.hostname.includes('vercel.app')) {
                addWarning('Vercel Deployment', 'Running on Vercel - ensure all functionality matches localhost');
            }
            
            // Test keyboard shortcut
            let keyboardTested = false;
            document.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'c' && !keyboardTested) {
                    keyboardTested = true;
                    addTest('C Key Response', !!window.mainUI, 'C key detected and mainUI available');
                }
            });
            
            addWarning('Manual Test', 'Press C key to test keyboard shortcuts');
            
        }, 2000);
        
    </script>
</body>
</html>